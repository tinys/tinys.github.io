(this["webpackJsonppsylocke-web"]=this["webpackJsonppsylocke-web"]||[]).push([[0],{132:function(e,t,a){e.exports=a(294)},276:function(e,t,a){},277:function(e,t,a){},279:function(e,t,a){},292:function(e,t,a){},293:function(e,t,a){},294:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(12),o=a.n(s),i=(a(98),a(62)),c=a(4),u=a.n(c),l=a(7),p=a(67),m=a(129),d=(a(138),a(15)),h=a(16),f=a(20),v=a(17),b=a(21),g=a(295),y=a(296),_=a(297),k=a(97),w=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={confirmDirty:!1,autoCompleteResult:[]},a.handleSubmit=function(e){e.preventDefault(),a.props.form.validateFieldsAndScroll((function(e,t){e||(console.log("Received values of form: ",t),a.props.onResult(t))}))},a}return Object(b.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.props,a=t.name,n=t.roomId,s=t.role;return r.a.createElement(g.a,Object.assign({},{labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},{onSubmit:this.handleSubmit}),r.a.createElement(g.a.Item,{label:"\u4f60\u7684\u6635\u79f0"},e("name",{initialValue:a,rules:[{required:!0,message:"\u6635\u79f0\u4e0d\u80fd\u4e3a\u7a7a!"}]})(r.a.createElement(y.a,null))),r.a.createElement(g.a.Item,{label:"\u623f\u95f4\u53f7",hasFeedback:!0},e("roomId",{initialValue:n,rules:[{required:!0,message:"\u623f\u95f4\u53f7\u4e0d\u80fd\u4e3a\u7a7a!"}]})(r.a.createElement(y.a,null))),r.a.createElement(g.a.Item,{label:"\u89d2\u8272"},e("role",{initialValue:s,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u89d2\u8272"}]})(r.a.createElement(_.a.Group,null,r.a.createElement(_.a,{value:"1"},"\u901a\u5173\u5e08"),r.a.createElement(_.a,{value:"2"},"\u7ecf\u7eaa\u4eba")))),r.a.createElement(g.a.Item,{wrapperCol:{xs:{span:24,offset:0},sm:{span:16,offset:8}}},r.a.createElement(k.a,{type:"primary",htmlType:"submit"},"Register")))}}]),t}(n.Component),E=g.a.create({name:"register"})(w),x=(a(276),a(277),function(e){function t(){return Object(d.a)(this,t),Object(f.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.props.stream.play(this.getDivId())}},{key:"getDivId",value:function(){var e=this.props.stream;return"video_".concat(e.getId())}},{key:"render",value:function(){return r.a.createElement("div",{className:"single_video"},r.a.createElement("div",{id:this.getDivId(),className:"single_video_player"}))}}]),t}(r.a.Component)),O=a(64),j=a.n(O),S=a(70),I=a.n(S);function C(e){var t="d716b05c897b698cefd09935099c219e77a789ec30521d95c9881770afb5714f";return{sdkAppId:1400308446,userSig:new window.LibGenerateTestUserSig(1400308446,t,604800).genTestUserSig(e)}}var P=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(f.a)(this,Object(v.a)(t).call(this))).name=e.name,a.roomId=e.roomId,a.localStream_=null,a.client_=null,a.remoteStreams_=[],I.a.checkSystemRequirements().then((function(e){e||alert("Your browser is not compatible with TRTC! Please download Chrome M72+")})),a}return Object(b.a)(t,e),Object(h.a)(t,[{key:"_initialize",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.name,a=C(t),this.client_=I.a.createClient({mode:"videoCall",sdkAppId:a.sdkAppId,userId:t,userSig:a.userSig}),this.bindEvents(),e.next=6,this.client_.join({roomId:this.roomId});case 6:return e.prev=6,e.next=9,this.createLocalStream({audio:!0,video:!0});case 9:console.log("createLocalStream with audio/video success"),e.next=25;break;case 12:return e.prev=12,e.t0=e.catch(6),console.error("createLocalStream with audio/video failed: "+e.t0),alert("\u8bf7\u786e\u8ba4\u5df2\u8fde\u63a5\u6444\u50cf\u5934\u548c\u9ea6\u514b\u98ce\u5e76\u6388\u4e88\u5176\u8bbf\u95ee\u6743\u9650\uff01\r\n\r\n \u5982\u679c\u60a8\u6ca1\u6709\u8fde\u63a5\u6444\u50cf\u5934\u6216\u9ea6\u514b\u98ce\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u7b2c60\u884c\u4ee3\u7801\u6765\u5173\u95ed\u672a\u8fde\u63a5\u8bbe\u5907\u7684\u91c7\u96c6\u8bf7\u6c42\uff01"),e.prev=16,e.next=19,this.createLocalStream({audio:!1,video:!0});case 19:e.next=25;break;case 21:return e.prev=21,e.t1=e.catch(16),console.error("createLocalStream with video failed: "+e.t1),e.abrupt("return");case 25:case"end":return e.stop()}}),e,this,[[6,12],[16,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"createLocalStream",value:function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.localStream_=I.a.createStream({audio:t.audio,video:t.video,userId:this.name}),this.localStream_.setVideoProfile("480p"),e.next=4,this.localStream_.initialize();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publish",value:function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPublished_){e.next=3;break}return console.warn("duplicate RtcClient.publish() observed"),e.abrupt("return");case 3:return e.prev=3,e.next=6,this.client_.publish(this.localStream_);case 6:this.isPublished_=!0,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("failed to publish local stream "+e.t0),this.isPublished_=!1;case 13:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"unpublish",value:function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isPublished_){e.next=3;break}return console.warn("RtcClient.unpublish() called but not published yet"),e.abrupt("return");case 3:return e.prev=3,e.next=6,this.client_.unpublish(this.localStream_);case 6:this.isPublished_=!1,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("failed to unpublish local stream because "+e.t0),t||(console.warn("leaving the room because unpublish failure observed"),this.leave());case 13:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"bindEvents",value:function(){var e=this;this.client_.on("error",(function(e){console.error(e)})),this.client_.on("client-banned",(function(e){console.error("client has been banned for "+e)})),this.client_.on("peer-join",(function(e){var t=e.userId;console.log("peer-join "+t)})),this.client_.on("peer-leave",(function(e){var t=e.userId;console.log("peer-leave "+t)})),this.client_.on("stream-added",(function(t){var a=t.stream,n=a.getId(),r=a.getUserId();console.log("remote stream added: [".concat(r,"] ID: ").concat(n," type: ").concat(a.getType())),console.log("subscribe to this remote stream"),e.client_.subscribe(a)})),this.client_.on("stream-subscribed",(function(t){var a=t.stream;e.remoteStreams_.push(a),e.emit("remoteStreamUpdate",e.remoteStreams_)})),this.client_.on("stream-removed",(function(t){var a=t.stream,n=a.getId();a.stop(),e.remoteStreams_=e.remoteStreams_.filter((function(e){return e.getId()!==n})),console.log("stream-removed ID: ".concat(n,"  type: ").concat(a.getType())),e.emit("remoteStreamUpdate",e.remoteStreams_)})),this.client_.on("stream-updated",(function(e){var t=e.stream;console.log("type: "+t.getType()+" stream-updated hasAudio: "+t.hasAudio()+" hasVideo: "+t.hasVideo())})),this.client_.on("mute-audio",(function(e){console.log(e.userId+" mute audio")})),this.client_.on("unmute-audio",(function(e){console.log(e.userId+" unmute audio")})),this.client_.on("mute-video",(function(e){console.log(e.userId+" mute video")})),this.client_.on("unmute-video",(function(e){console.log(e.userId+" unmute video")})),this.client_.on("connection-state-changed",(function(e){console.log("RtcClient state changed to ".concat(e.state," from ").concat(e.prevState))}))}}]),t}(j.a.EventEmitter),T=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(f.a)(this,Object(v.a)(t).call(this,e))).init=Object(l.a)(u.a.mark((function e(){var t,n,r,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props,n=t.name,r=t.roomId,t.role,(s=new P({name:n,roomId:r})).on("remoteStreamUpdate",(function(e){var t=[],n=[];e.forEach((function(e){"1"==e.getUserId().split("$")[0]?t.push(e):n.push(e)})),a.setState({roles:t,agents:n})})),e.next=5,s._initialize();case 5:return e.next=7,s.publish();case 7:a.rtcClient=s,a.forceUpdate();case 9:case"end":return e.stop()}}),e)}))),a.state={roles:[],agents:[]},a}return Object(b.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.init()}},{key:"render",value:function(){var e=this.props.role,t=this.state,a=t.roles,n=t.agents,s=null,o=null;return this.rtcClient&&("1"==e?s=r.a.createElement(x,{stream:this.rtcClient.localStream_}):o=r.a.createElement(x,{stream:this.rtcClient.localStream_})),r.a.createElement("div",{className:"video_wrapper"},r.a.createElement("div",{className:"agent_videos"},o,n.map((function(e){return r.a.createElement(x,{key:e.getId(),stream:e})}))),r.a.createElement("div",{className:"roles_videos"},s,a.map((function(e){return r.a.createElement(x,{key:e.getId(),stream:e})}))))}}]),t}(n.Component),D=a(299),M=a(2),N=a.n(M),A=function(e){var t=e.list,a=e.user;return r.a.createElement("div",{className:"message-wrapper"},t.map((function(e,t){var n,s=e.sender,o=N()({"message-mine":s.name==a.name});return r.a.createElement("div",{key:t,className:o},(n=s.name,console.log(n),n.split("$")[1]),":",e.payload.text)})))},G=(a(279),a(30)),R=a.n(G),L=a(127),U=a.n(L),V=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(f.a)(this,Object(v.a)(t).call(this))).messageResolveUtil={receiveMessage:function(e){this.emit("receiveMessage",z(e.data))}},a.name=e.name,a}return Object(b.a)(t,e),Object(h.a)(t,[{key:"_initialize",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t,a,n,r,s,o=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.name,a=C(t),n={SDKAppID:a.sdkAppId},r=R.a.create(n),this.tim=r,r.setLogLevel(0),r.registerPlugin({"cos-js-sdk":U.a}),e.next=9,r.login({userID:t,userSig:a.userSig});case 9:return s=function(){r.on(R.a.EVENT.MESSAGE_RECEIVED,o.messageResolveUtil.receiveMessage.bind(o))},e.abrupt("return",new Promise((function(e,t){r.on(R.a.EVENT.SDK_READY,(function(){e(!0),s()}))})));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var a,n,r,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.tim,n=!1,r=null,e.prev=3,e.next=6,a.getGroupProfile({groupID:t});case 6:(s=e.sent)&&(n=!0),r=s,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),console.log(e.t0);case 14:if(n){e.next=19;break}return e.next=17,a.createGroup({type:R.a.TYPES.GRP_AVCHATROOM,name:"WebSDK",groupID:t});case 17:o=e.sent,r=o.data.group;case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this,[[3,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"joinGroup",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.tim,e.next=3,a.joinGroup({groupID:t,type:R.a.TYPES.GRP_AVCHATROOM});case 3:return n=e.sent,e.abrupt("return",n.data.status);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"roomExists",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.tim,n=!1,e.prev=2,e.next=5,a.getGroupProfile({groupID:t});case 5:e.sent.data.group&&(n=!0),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(2);case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupMessage",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var a,n,r=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>1&&void 0!==r[1]?r[1]:50,a=this.tim,e.next=4,a.getMessageList({conversationID:"GROUP".concat(t)});case 4:return n=e.sent,console.log("get group messages ",n),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMessageToGroup",value:function(){var e=Object(l.a)(u.a.mark((function e(t,a){var n,r,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.tim,r=n.createTextMessage({to:t,conversationType:R.a.TYPES.CONV_GROUP,payload:a}),e.next=4,n.sendMessage(r);case 4:return s=e.sent,e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()}]),t}(j.a.EventEmitter),z=function(e){var t=[].concat(e),a=[];return t.forEach((function(e){var t=e.type,n=e.from,r=e.nick,s=e.avatar,o=e.payload;switch(t){case R.a.TYPES.MSG_GRP_TIP:case R.a.TYPES.MSG_GRP_SYS_NOTICE:return}a.push({type:t,sender:{name:n,nick:r,avatar:s},payload:o})})),a},Y=y.a.TextArea,K=y.a.Search,q=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(f.a)(this,Object(v.a)(t).call(this,e))).changeText=function(e){a.setState({text:e.target.value})},a.sendMessage=Object(l.a)(u.a.mark((function e(){var t,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=a.state.text).trim()){e.next=4;break}return D.a.error("\u8bf7\u8f93\u5165\u6d88\u606f\u5185\u5bb9"),e.abrupt("return");case 4:return e.prev=4,e.next=7,a.tim.sendMessageToGroup(a.props.roomId,{text:t});case 7:n=e.sent,a.setState({text:""}),D.a.info("\u53d1\u9001\u6210\u529f"),r=a.state.messageList,a.setState({messageList:r.concat(z(n.data.message))}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),D.a.error(e.t0.message);case 17:case"end":return e.stop()}}),e,null,[[4,14]])}))),a.state={text:"",messageList:[]},a}return Object(b.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.initializeSDK()}},{key:"initializeSDK",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t,a,n,r,s,o=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,a=t.name,n=t.roomId,r=t.role,s=this.tim=new V({name:a}),e.next=4,s._initialize();case 4:if("1"!=r){e.next=9;break}return e.next=7,s.createGroup(n);case 7:e.next=14;break;case 9:return e.next=11,s.roomExists(n);case 11:if(e.sent){e.next=14;break}return D.a.warning("\u623f\u95f4\u53f7\u8fd8\u6ca1\u521b\u5efa"),e.abrupt("return");case 14:return e.next=16,s.joinGroup(n);case 16:s.on("receiveMessage",(function(e){var t=o.state.messageList;o.setState({messageList:t.concat(e)})}));case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderPC",value:function(){var e=this.state,t=e.text,a=e.messageList,n=this.props,s=n.name,o=n.role;return r.a.createElement("div",{className:"feed-container"},r.a.createElement("div",{className:"feed_list_wrapper"},r.a.createElement(A,{list:a,user:{name:s,role:o}})),r.a.createElement("div",{className:"feed_editor_wrapper"},r.a.createElement(Y,{rows:4,onChange:this.changeText,value:t}),r.a.createElement(k.a,{onClick:this.sendMessage},"\u53d1\u9001")))}},{key:"renderH5",value:function(){var e=this.state,t=e.text,a=e.messageList,n=this.props,s=n.name,o=n.role;return r.a.createElement("div",{className:"feed-container"},r.a.createElement("div",{className:"feed_list_wrapper"},r.a.createElement(A,{list:a,user:{name:s,role:o}})),r.a.createElement("div",{className:"feed_editor_wrapper"},r.a.createElement(K,{placeholder:"\u8f93\u5165\u5185\u5bb9",enterButton:"\u63d0\u4ea4",size:"large",onChange:this.changeText,value:t,onSearch:this.sendMessage})))}},{key:"render",value:function(){return this.props.mobile?this.renderH5():this.renderPC()}}]),t}(n.Component),H=(a(292),function(e){function t(){return Object(d.a)(this,t),Object(f.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props.roomInfo;return r.a.createElement("div",{className:"room_page"},r.a.createElement("div",{className:"page_room_video"},r.a.createElement(T,e)),r.a.createElement("div",{className:"page_feed_list"},r.a.createElement(q,Object.assign({mobile:this.props.mobile},e))))}}]),t}(n.Component));a(293);var $=function(){var e,t,a=Object(n.useState)({showPage:"1",profileInfo:{name:"dongyajie",roomId:"12345",role:"1"}}),s=Object(m.a)(a,2),o=s[0],c=s[1],d={1:{page:E,props:Object(p.a)({},o.profileInfo,{onResult:function(){var e=Object(l.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t,c(Object(p.a)({},o,{showPage:"2",profileInfo:a}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})},2:{page:H,props:{roomInfo:Object(p.a)({},o.profileInfo,{name:(e=o.profileInfo.name,t=o.profileInfo.role,"".concat(t,"$").concat(e))})}}},h=d[o.showPage].page,f=d[o.showPage].props,v=navigator.userAgent.toLocaleLowerCase().indexOf("mobile")>=0,b=N()({App:1,App_mobile:v}),g=N()(Object(i.a)({"App-body":1},"App-body-".concat(o.showPage),1));return r.a.createElement("div",{className:b},r.a.createElement("div",{className:"App-header"},"\u76f4\u64addemo"),r.a.createElement("div",{className:g},r.a.createElement(h,Object.assign({},f,{mobile:v}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement($,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},98:function(e,t,a){}},[[132,1,2]]]);